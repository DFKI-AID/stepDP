<!doctype html>

<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Hello There</title>
    <meta name="description" content="Hello!">
    <meta name="author" content="Yannick KÃ¶rber">
    <link rel="stylesheet" type="text/css" href="/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/hello.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <link rel="manifest" href="/manifest.json">
</head>


<div id="app" class="container-fluid">
    <div class="row">
        <div class="btn-toolbar">
            <div class="btn-group">
                <button v-on:click="undo">undo</button>
                <button v-on:click="hello">hello</button>
                <button v-on:click="repeat">repeat</button>
            </div>
            <div class="btn-group">
                <button v-on:click="showTasks">show_tasks</button>
                <button v-on:click="selectTask">select_task</button>
                <button v-on:click="selectTaskSupp">select_task_supp</button>
                <button v-on:click="acceptTask">accept_task</button>
                <button v-on:click="accept">accept</button>
                <button v-on:click="reject">reject</button>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm">
            <h2>iteration={{iteration}}</h2>

            <table>
                <tr>
                    <th>name</th>
                    <th>active</th>
                    <th>priority</th>
                </tr>
                <tr v-for="item in rules">
                    <td>{{item.name}}</td>
                    <td>{{item.active}}</td>
                    <td>{{item.priority}}</td>
                </tr>
            </table>
        </div>
        <div class="col-sm">
            <div id="grammar">Grammar: {{grammar}}</div>
        </div>
    </div>
</div>

<body>


<!--<div class="menu">menu</div>-->


<!--<link rel="stylesheet" href="css/styles.css?v=1.0">-->
<div id="rules">


    <!--<div>Tokens: {{tokens}}</div>-->
</div>


<script src="/jquery-3.3.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@2.5.22/dist/vue.js"></script>
<script src="/bootstrap.min.js"></script>
<script>
    const app = new Vue({
        el: '#app',
        data: {
            interval: null,
            iteration: 0,
            rules: [],
            tokens: [],
            grammar: null
        },
        methods: {
            updateData: function () {
                $.get('/iteration', function (response) {
                    this.iteration = response.iteration;
                }.bind(this));

                $.get('/rules', function (response) {
                    this.rules = response;
                }.bind(this));

                $.get('/tokens', function (rsp) {
                    this.tokens = rsp;
                }.bind(this));

                $.get('/grammar', function (rsp) {
                    this.grammar = new XMLSerializer().serializeToString(rsp);
                }.bind(this));
            },
            undo: function (event) {
                var payload = {intent: "undo"};
                $.post("/input/intent", payload);
            },
            hello: function (event) {
                var payload = {intent: "greetings"};
                $.post("/input/intent", payload);
            },
            repeat: function (event) {
                var payload = {intent: "repeat"};
                $.post("/input/intent", payload);
            },
            selectTask: function (event) {
                var payload = {intent: "select_task"};
                $.post("/input/intent", payload);
            },
            acceptTask: function (event) {
                var payload = {intent: "accept_task"};
                $.post("/input/intent", payload);
            },
            selectTaskSupp: function (event) {
                var payload = {intent: "select_task_supp", task: "third"};
                $.post("/input/intent", payload);
            },
            showTasks: function (event) {
                var payload = {intent: "show_tasks"};
                $.post("/input/intent", payload);
            },
            accept: function (event) {
                var payload = {intent: "accept"};
                $.post("/input/intent", payload);
            },
            reject: function (event) {
                var payload = {intent: "reject"};
                $.post("/input/intent", payload);
            }
        },
        created() {
            this.updateData();
            this.interval = setInterval(function () {
                this.updateData();
            }.bind(this), 250);
        }
        // created() {
        //     fetch('http://localhost:50000/rules')
        //         .then(rsp => rsp.json())
        //         .then(json => {
        //             this.items = json
        //         })
        //     fetch('http://localhost:50000/iteration')
        //         .then(rsp => rsp.json())
        //         .then(json => this.iteration = json.iteration)
        // },
    });
</script>
</body>
</html>